from Crypto.Util.number import *
from sympy import divisors
from itertools import combinations

mod_phi = 381679521901481226602014060495892168161810654344421566396411258375972593287031851626446898065545609421743932153327689119440405912
n = 1236102848705753437579242450812782858653671889829265508760569425093229541662967763302228061
c = 337624956533508120294617117960499986227311117648449203609049153277315646351029821010820258

def get_primes(modulus: int):
    primes = []
    for i in divisors(modulus):
        if isPrime(i + 1):
            primes.append(i + 1)
    return primes


# print(get_primes(mod_phi))
primes_list = [
    2,
    3,
    5,
    7,
    13,
    19,
    37,
    73,
    269,
    1609,
    2693,
    19087,
    24229,
    57259,
    270547,
    1514407,
    3028813,
    9086437,
    47792819,
    286756909,
    (290056379),
    304395607,
    405860809,
    (1160225513),
    5163640957,
    9634650973,
    (19433777327),
    22762026983,
    430347743417,
    (117710389263583),
    289624031318969,
    366693837187897,
    409261944324137,
    (616053023008139),
    6855137567429279,
    10661204146632983,
    (58861257970316713),
    (98541359736375989),
    107089408816179059,
    (249527010302877673),
    (1497746992989817369),
    3263584238585445829,
    (3625718256793784869),
    6074022159481704313,
    (17636981995699982803),
    (23515975994266643737),
    610439227027911283357,
    (1000024086976558220089),
    (2812855605391764277039),
    3460487154313434392957,
    (5625711210783528554077),
    10381461462940303178869,
    12263450739993561005929,
    (19814317564171362688367),
    (20488095083574808085107),
    (62507944422231369813877),
    (468857564904399336495737),
    (941817461108098027270267),
    2299633900613012475079669,
    (9192325327497230560850893),
    (55662304678036985776665529),
    65195090985565133928838297,
    77037735670535917915168879,
    (86896840614468619358296249),
    (236655855885495565096222747),
    (262915676303519782930822027),
    (665760298618857738832603589),
    (1705239705507982862070137053),
    (2056769232422963306257864159),
    (11147129893006787355989811727),
    (12340615394537779837547184949),
    (18730365524159445713847950173),
    (25337796356994900094100282893),
    29174610877405644885579737209,
    (33441389679020362067969435179),
    (67415129334784602319798616869),
    (69896623696722453965254507129),
    (995810270441939670468423180857),
    (3961801768040877416807308070713),
    (8540103834403921458035959694153),
    (8620903777807992049067677047523),
    (15680142582631403839538761099049),
    (19004076996981570720590100589639),
    (21868438188743678225719590367813),
    (31817338996526715316671669165293),
    36635328159542597884404036074809,
    (45012110507961407343486859749589),
    (100013493701803323166425841130857),
    (380686793401735393626380916065977),
    (593754786300253082392245592566037),
    (787927164777228042936822745227163),
    2778385468650835748969171567926297,
    (4420174520235217391142272744658269),
    (4518524961981045847483274977633843),
    (6630261780352826086713409116987403),
    (9503017410827430275280162414908809),
    (17385493641227181089410369156069897),
    (57674163725929331237494864716288169),
    (74817800333025743420359198584107533),
    (125354310391098601972275509070650377),
    (289662031250376417334582417567626397),
    (447588475284813495991407581121732349),
    (455031677478751142146707495433883327),
    (629577991740368351696577743317520173),
    736503681314859043122577896464462299,
    (908223517358190215344138270504402243),
    (1086705294833923163483968941397027693),
    (1180579552140125813224434092494386899),
    (2827158909481631635102501204261722953),
    (4304026898077158361032126702996544717),
    (5512042078358651764324940418321663883),
    (7108401961962003861731481420924885587),
    (16381140389235041117281469835619799737),
    (19399776731166457619367608364872930569),
    (21315575872184236856490840242695946713),
    (26647196849250538895256049588618987673),
    (80429968284522913374805758878217336863),
    (145618509507745703906851838147201710729),
    (235422655691499697583912466632778315067),
    (241289904853568740124417276634652010587),
    (308776508606152118670230312260475727067),
    (316866726866769688962122433993964931119),
    (471913317206578421221279160929226713259),
    592148959777146670670552628757427687593,
    (2636629441418639853033692563745102129399),
    (4757309980157903757412268119298427378703),
    (5185214314300064374563757803875917632379),
    5220545237231883643295894165042561939849,
    (10040908221737001942675307047220423513213),
    (22611826641001134284167842399962061049067),
    (44771579206927442445495285480737910484217),
    (60176301979892201826179788808047907217097),
    (67063832933253182508754527435122491363429),
    (71841132938325866663791691670660730445689),
    (83671573087220894172926996239356339810793),
    (134314737620782327336485856442213731452649),
    (142167538120890667114338932051958932428277),
    (271341919692013611410014108799544732588793),
    (280154073073132645663581435169586152699817),
    (320524952866828716129334228750924015958327),
    (463212478744139084127695697146248641825769),
    (1310626984374809863172939155590503220744277),
    (9761714158582152461294710635172566931954633),
    (10088668697921527901552283258325531661100709),
    (10124662808116862957254749466954060389276403),
    (11917579432408193926749885449435485833050569),
    24909831599451932803986359008500584295984733,
    44682782103975434144703962916021508370826073,
    (101338418413450571309622188550046012058519053),
    (239575485469934795888462953061259300943446793),
    (509595841858339460218544784630966672723782023),
    (718726456409804387665388859183777902830340377),
    (885155638896815121721984702668159252469789007),
    1396480793192855813962038749872058535698968723,
    (1872615679306253578100092519662389260256997973),
    (2163766322903013114466094496400171628431135117),
    (7162437301435525040476528101521240400744204649),
    (17121742968045981883374742768778472512535922399),
    (21469572813678356308682415844469764457481382723),
    (25425880567667310151542274988903391024284855887),
    (34243485936091963766749485537556945025071844797),
    (88205255427982495391323733236414937946224158333),
    (161801637257080869559520177341923945103794881453),
    (165210669342891849361206337411147617324821774137),
    (173373737789678200634863149461868639375557904523),
    (330803561483186384274713015810198603419076006677),
    (355832566836519678932237850472600019492855180413),
    (419926055098744614807070467727627148885956905049),
    (533748850254779518398356775708900029239282770619),
    (645898118206516654865872694199236757068927232169),
    (2271378664044946373537776565675369598169447125817),
    (5567301924732310238368540486036809285944700412393),
    (6794587274919789651294185769873639801018892921769),
    (27796695116941553655022966269425586614901263498383),
    (42854805623216688352867840664455695430765917152137),
    (61151285474278106861647671928862758209170036295913),
    (128622500080886738098620922185640619162155306134823),
    (164889578605484367639744181565008898759342231942393),
    (282648887905970805842031188582523580027203524494597),
    (4258717199120560126828813207075485881156148626526787),
    (5460966149477706865231310412540490727716111408100953),
    (29114158399421410054768372001840755821677094678817459),
    (42304082351469205892106661493403449548304676462158909),
    (62773719295184081318822843155733034062554760439368969),
    (97261119546839328963450622202856216931684942728648037),
    (297294750612774023875294003582674290943572199080297737),
    440195255012087499323041582243594212003442807011447907,
    (488459199110510269285901908826356977291697253025646147),
    (550692293926945771367339749324533540437979931443666187),
    (1088856039331209929684588964299887428079847917750925593),
    1246058922332722894626476510808127417162976219812317913,
    (1858033076168329499634875016369559603926203023641117733),
    (4392600389973531411834192875636009238544236531481122073),
    (7293895457865080671158792094339777523348892914639292613),
    (7717322802496634224993367021258444517376363165562242357),
    (11148198457009976997809250098217357623557218141846706393),
    (26415384047553654225380158659111043232182601510213363209),
    (35940306267416137403574842955092531028425889976066679557),
    (51228769492115158755685654682793073754273776749644625647),
    (61376785121813826410882406461172670768031339823405186853),
    (92763505216151233826773371461292032523276952947736142713),
    (142846774414197053738400555341292768215585671292154631687),
    (151215524525288774293897761338599560906140743602187708339),
    (157615766949872361657885037566081153248583860879071183037),
    (201853928940035315914186935315774559519735763739191229523),
    (294971788531015805516745105026739982759372383530715889157),
    (373464648309834229426609878290281480389166807751864664133),
    (413968352354488964990331387622630397185461988443238120937),
    (454279287638187962219059662639789880897011967901880262063),
    1185005626492539548177627939399755618713268036474817762953,
    (1250456260261285753254270886016713613442334634910472233637),
    (1385978752442616214732540908683721442551782011449549627853),
    (1428997006469620899441715174791741129795408628264957761013),
    (1907533377310097962880981473399054943582606166355207320629),
    (2128318592752445011650296118181366593638894877715141821337),
    (4304591605108415693997473451254777597421902542371047781703),
    (6174978245049582419565930555496072591634552552688507413689),
    (8865604822937184207507806140607353650133877727303593258239),
    (12547915800675262252806679958113728033310656713374242482389),
    (15219392532035795661796951150970214102290678503134622461479),
    (15345777059466004556645002747108908642418898665445559749017),
    (21006834163817043522733571173658057130393213850997177091163),
    (21684811608761216469945192842628237124854494558974490367433),
    (23207658018268406380692356867426261400423804890494614530957),
    (105265701701422451892123066634353938574577641511227933429007),
    (317472097096227479080268370831115206187789806378635006894377),
    (394817768195817508572914563927425484366318081649643346226617),
    (3375149559140048709338662631832556372731915315801406262780803),
    (4551979413087451867648804277353503448783814809925262865919477),
    (11438626169914055692737689252750539973904125925917634719300677),
    (12548397641104425853449114277683357115521243256099111233080377),
    (19642605797502721676639225097033006913989511670102142082941529),
    (33158957356366020201327763777657736705868552456095514473281933),
    (35925279403568837004463725560072759009333855905376906822189119),
    (56620949806933750971108610804873092034100832422755505163575353),
    (102949612052031379177143243272452912424120160893586821548846889),
    (116198606042924156357336666554873272444634796523615082484686873),
    (180713668893206456846515719813541645792393959009446386669621369),
    (324175668202190695320690591184958831430924960679975996488578803),
    (348595818128772469072009999664619817333904389570845247454060617),
    (626492902102809463698248020243398798417688468951745337335280677),
    (881691075351376322318767472751707323507108507563177111888446959),
    (1227789337765102638411445530885643382391745105261379584912462757),
    (2294559788380837263083137193933618528784802907931072958763153773),
    (8856389458380242760007918047192522816720657098358480541804847803),
    (11276872237850570346568464364381178371518392441131416072035052169),
    (14690203540203673304709545756793462633591500006210382949064462569),
    (17775104915696375222461174721095489182212791298925264003472117439),
    (22980652173559153766337582380062119328571859154379426847033345343),
    (25429585787358430874202620505587136150265915152943007227824991213),
    (29677071182756943880186919652503740880928745589378674266834356473),
    (34296243457990625040191816370397063402283093786267052914057960057),
    (37659455652211035760724462153352971942353374988517147948698002397),
    (104424235829926896702817649355230202619477230823025841301391747497),
    (163260490658819660859726776359124197518406333176720836127495863567),
    (364860897495383836373115238303540582854843403240072254685965541993),
    (493571313781571260641401103416028639721481532315074593134810027913),
    (2872877458770928167299342313179821189029651224578762612985667854219),
    (5774241367824955141805371010166978079906750575655073841572419846153),
    (7064309126311570630905116668228478499296412746467871829886757379337),
    (14859801923310423068979906259194519509334940798832582853463200315977),
    (29518471400611065248578062221110903413999616717952182221619177481173),
    (45197269594005785747293098060893374847720366227382015943629833509839),
    (97749033157861086904113894841251908448210253141859797440906207541897),
    (115429643567333412333878052344478785684594344724866103793394296470969),
    (338259343638739987277439636803766650085378859703656614597602128427743),
    (425404933697323038569197707919313001083236185842767534452636862812253),
    (926955515937736836445498514640106690545282048266876716681704854156443),
    (1827363869867791985735240311893403732934597232346434546603607713213779),
    (3396205029627695626973653445913677715705312063214453436309483252076073),
    (18169302376790325870411825420479136688783587223407570409339193070954877),
    (22456395936368542490405980912764805855646454732982061767210255745238727),
    (32119491704920355209836880139486021311092243364696468389103652851601413),
    (48909883856977014967721385689230679090289949192255290512086270096715497),
    (89032032064791071523966891108244212924054640582836126420713098516314443),
    (596926991063319000914233206307830246040239884690636363191025569712569369),
    (1781300387386964105486838706008421916723390614552483600990849608209331929),
    (2421582112548863331392462864129017003082564834798548600278714440546264443),
    (2549562770552409176651225914158904031336914329394748110873365327969405299),
    (12368637102572096415294865453554395776310010988958004153294135116707993619),
    (31859454874555361812137972209109263243353002819477316475211283061811465907),
    (214301386420765000985944275850514542280434117516847815444487470576813162219),
    (1300603030890237110001536748953223841502515720972201959822509226844334573779),
    (1629724761745385022027127507558828443074566133819423207987574818487635969467),
    (1761700057758888299868043298854770132736215445785466173655013901772304225323),
    (2499889290386819267715075819429241790332781906413741377733315751116515307213),
    (3040844511390276884113378205816059803955435059044718732631581111981680056843),
    (9075665010981546799200975187806856690487095698694687496207202216682591616149),
    (9258677696538641666150884102010634474801205099555820685405814994010815929423),
    (10333482735937820632370721394118004977680283635159315624010138459318870846603),
    (11638910251223582833377845458724371872925978750239904135904224178247454423837),
    (13916150252568943717608496294246284019330266346020754262833252589564105336599),
    (17018613538919535843039237646750108916077990484964379984753264871409169835983),
    (33284900063607115777102136837611803377438655447206702589040000100873750048447),
    (35845579211557122778954396687450462787008356305968324616611306342129015480567),
    (50996848790501395375982705314315111053873949904023053012767033433424963766713),
    (217729958712816944511890596800638834582474689228421056463306336316879429131269),
    (419353841193085035311217224150496230373549369442028400845676671318357144396887),
    (1483140431380406257997297737112034530211706372767026621561757854284886014452853),
    (1923608466442120272024064476080702761013467981481618344408827427875115913545423),
    (5870019449663253958576298779930999668242612247537223378150716251611846209054109),
    (6172688820068927283863979189146561263853106703551545964782738768226601910693497),
    (10721811026390197168993915098068516202514055019518525540879737408112367741520409),
    (15393631487267330404940422378165705193212129864924029550530088108442792623991959),
    (29175814467517470564593339971285603834051608356608421566083049066461843503589913),
    (129169384623864923213380590433752424665151077384071871051950762124979471208859197),
    (610531667887837029333972746166072010192935478690538813991464152035006980557772813),
    (
        2019276842607876457584440117298465168955620279177709805160070044642977355399358573
    ),
    (
        28065536743686678799307605799428545795232595603071217294216824731624537760481779133
    ),
    (
        29780240430523054905130130984085989521439995583592310419685692777361163538127923277
    ),
    (
        72665264149587215046018887977866743843778893943871748124925908568589027145439680379
    ),
    (
        131035997703406185134264328768119972673788648057121059183096015926049842413681053389
    ),
    (
        237553204567994669298539501969915580362118799521964909055602987687778006081439110719
    ),
    (
        3465746291138784924454935643445693096807809761947544007007504717148790346332967783317
    ),
    (
        9737145396044686816166530989034143675066371788478814248740071748190929637488917170653
    ),
    (
        15185454285710724479590041439047198039350382365782882032938476020025660710998356072873
    ),
    (
        21051321068776408367381988146750562815044583544757142098893375272174635825507760875769
    ),
    (
        29211436188134060448499592967102431025199115365436442746220215244572788912466751511957
    ),
    (
        434538162214426355945998456024521545251813190603154457731975700151673559854118367212813
    ),
    (
        595602709204010894884243788118052427400169636704038372583184810914478801194609297149817
    ),
    (
        2332447253936402254158171688038951454151655969790697116716050674641135903082087318171669
    ),
    (
        20649239669878765841483823384078407353590752439434072083494778820663564784568163679896009
    ),
    (
        34492523447886617551667675922075780879399445292290955450003699339025984552237654404893399
    ),
    (
        51854247379956751534770944542853612496143941760220636239522336366815593656770052823022439
    ),
    (
        390958973199401648289527178033340704286075995151631869909558504055912869882129207022499379
    ),
    (
        803028507022686614124233037355321985960457035035035859743196160099356466332795296287696057
    ),
    (
        824068565803835625052828300541855239102447925031752717780598992939470726081833316755646889
    ),
    (
        1616491088058745822138949258145565308112189768837478695778414032557134336389107930934626259
    ),
    (
        44517088288630173422862864837911427453938505839425245169642543176200719846224718554624455449
    ),
    (
        60479637743691054641765963759070069108719138553189225709641549135204229807541252507497186109
    ),
    (
        109677866681083426667125956299045262543102901121426788286008398693982558180739330002880961613
    ),
    (
        457025060039727225857438161498248854161102018815689165834793251697053120726097866414027039563
    ),
    (
        541609060822026573945266892057179263479594670973921518621939272426035543181015949948500981097
    ),
    (
        11918071088691872152155919974111280623644021368207947178449238378260513980628476164143507206953
    ),
    (
        62559915596026678545800966834223175044401173122807688031588753395442928356143851238457646729847
    ),
    (
        1334107732780107724445901271049474325504181699609744393636400578743688298132095521658012214549587
    ),
    (
        489011541401143792724987373106128689678285629806510623447330416701166811981964698053296424228331323
    ),
    (
        1168923936568712308140650361915526778799392925130575572210248729504276485251802195581052763141564309
    ),
    (
        3802976532698147243081910415767138341619824678812228268049163448688541864130059632651752974297951433
    ),
    (
        46887386571631494374951234972705250997575693049575831768011732927235554604206469507657696017999043517
    ),
    (
        278358541068688249925888255730696668103723527319963294985449183577201503808476481130938587494400747247
    ),
    (
        877125823813271246175582507656608322177260565036952195491544183218502212595110140146127436176016619109
    ),
    (
        3024317087628201595060889258138816766173165575825424530166097232569562917449429922866306552810445876299
    ),
    (
        22295019883529206786386763209509320548564840463867543579951985922284054362982659798994468999060237070619
    ),
    (
        162086806631391878476008452391212476261235326932139385555404801144814376551185952261374535042901601903087
    ),
]


def keep_valid_primes(primes):
    valid_lengths = {127, 128, 149, 150}
    return [p for p in primes if p.bit_length() in valid_lengths]


valid_primes = keep_valid_primes(primes_list)
# print(valid_primes)


valid_primes_list = [
    145618509507745703906851838147201710729,
    235422655691499697583912466632778315067,
    241289904853568740124417276634652010587,
    308776508606152118670230312260475727067,
    316866726866769688962122433993964931119,
    509595841858339460218544784630966672723782023,
    718726456409804387665388859183777902830340377,
    885155638896815121721984702668159252469789007,
    1396480793192855813962038749872058535698968723,
]


def find_pqe(primes, mod_phi):
    for p, q, r in combinations(primes, 3):
        if (p - 1) * (q - 1) * (r - 1) == mod_phi:
            return p, q, r
    return None


# print(find_pqe(valid_primes_list, mod_phi))
# pqe = (
#     308776508606152118670230312260475727067,
#     885155638896815121721984702668159252469789007,
#     1396480793192855813962038749872058535698968723,
# )

e = 308776508606152118670230312260475727067
p = 885155638896815121721984702668159252469789007
q = 1396480793192855813962038749872058535698968723

assert p * q == n

d = inverse(e, mod_phi)
pt = pow(c, d, n)
print("Decrypted flag is:", long_to_bytes(pt).decode())
