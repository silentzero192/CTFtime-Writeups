#!/usr/bin/env python3

delta = [
    0x6C, 0x1B, 0xB0, 0xC0, 0x12, 0xDE, 0x18, 0x7C, 0xE5, 0xDD,
    0x95, 0xA7, 0xC6, 0x7C, 0xE7, 0x36, 0x43, 0xE3, 0xC8, 0xBA,
    0x12, 0x7E, 0xD7, 0x1C, 0xA3, 0x39, 0x93, 0xA2, 0x25, 0x87,
    0xB6, 0x18, 0x3B, 0x50, 0xCA, 0xF3, 0x1A, 0x50, 0xE6, 0x60,
    0x6A, 0xDA, 0x35, 0x4C, 0x54, 0x26, 0x53, 0x7B
]

initial = "./devilishFruitPWD=/tmp/gogear5ONE_PIECE=IS_REAL"
assert len(initial) == 48

data = list(initial.encode())

def rol1(x):
    return ((x << 1) & 0xff) | (x >> 7)

for i in range(len(data)):
    v2 = delta[i] ^ data[i]

    if i > 0:
        prev_bit = data[i - 1] & 1

        # First 3 rounds: ROL + XOR
        for _ in range(3):
            v2 = rol1(v2)
            v2 ^= prev_bit

        # Final rotation ONLY
        v2 = rol1(v2)

    data[i] = v2

flag = bytes(data).decode()
print(flag)
